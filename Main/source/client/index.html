<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gamin âš”ï¸ Arena</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg-dark: #1e1e1e;
      --bg-panel: #252526;
      --bg-input: #333;
      --text-light: #f0f0f0;
      --text-dim: #aaa;
      --border-color: #444;
      --accent: #61dafb;
      --danger: #e91e63;
      --success: #4CAF50;
      --warning: #FF9800;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Nunito', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #2b2b2b 0%, var(--bg-dark) 100%);
      color: var(--text-light);
      display: flex;
      /* Sá»¬A: DÃ¹ng flex-wrap Ä‘á»ƒ cÃ¡c panel xuá»‘ng dÃ²ng */
      flex-wrap: wrap; 
      justify-content: center;
      align-items: flex-start; /* GiÃ³ng lÃªn trÃªn */
      min-height: 100vh;
      padding: 20px;
      gap: 20px; /* ThÃªm khoáº£ng cÃ¡ch giá»¯a cÃ¡c panel */
    }

    .panel {
      background: var(--bg-panel);
      padding: 24px 32px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.7);
      text-align: center;
      border: 1px solid var(--border-color);
      max-width: 400px;
      width: 100%;
    }
    
    /* Panel Ä‘Äƒng nháº­p sáº½ chiáº¿m giá»¯a mÃ n hÃ¬nh */
    #startPanel {
      margin-top: 20vh;
    }

    h2 {
      margin-top: 0;
      color: var(--accent);
      font-size: 24px;
    }

    h3 {
      margin-top: 0;
      color: var(--accent);
      font-size: 20px;
      text-align: center;
    }

    h4 {
      margin: 0 0 16px 0;
      color: var(--accent);
      font-size: 18px;
    }

    input, select {
      padding: 12px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      font-size: 16px;
      background: var(--bg-input);
      color: var(--text-light);
      width: 100%;
      transition: border-color 0.2s ease;
    }
    
    select {
      padding: 12px 8px; /* Äiá»u chá»‰nh padding cho select */
      font-size: 14px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
    }

    button {
      padding: 12px 20px;
      margin: 8px 0;
      border-radius: 6px;
      border: none;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      background: var(--accent);
      color: #000;
      transition: all 0.2s ease;
      width: 100%;
    }

    button:hover {
      filter: brightness(1.2);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(97, 218, 251, 0.3);
    }

    button.back { 
      background: var(--danger); 
      color: #fff; 
    }
    button.back:hover { 
      box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3); 
    }

    button.start { 
      background: var(--success); 
      color: #fff; 
    }
    button.start:hover { 
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); 
    }

    button.cancel { 
      background: var(--warning); 
      color: #000; 
    }
    button.cancel:hover { 
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3); 
    }

    button:disabled { 
      background: #555; 
      color: #888; 
      cursor: not-allowed; 
    }
    button:disabled:hover { 
      transform: none; 
      box-shadow: none; 
      filter: none; 
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }

    .button-group button {
      margin: 0;
      flex: 1;
    }

    #game-container {
      display: none;
      gap: 20px;
      padding: 20px;
      background-color: var(--bg-panel);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      border: 1px solid var(--border-color);
      max-width: 1100px;
      width: 100%;
    }

    #canvas-area { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      position: relative; 
      flex: 1;
    }
    
    #c { 
      border: 3px solid var(--accent); 
      background: #333; 
      border-radius: 4px;
    }
    
    #countdownDisplay {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 120px;
      color: white;
      font-weight: bold;
      text-shadow: 0 0 20px rgba(0,0,0,0.8);
      display: none;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    #info, #debug { 
      margin-top: 12px; 
      font-size: 14px; 
      color: var(--text-dim);
      text-align: center;
      width: 100%;
    }

    #sidebar {
      width: 280px;
      padding: 20px;
      background: #2d2d30;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      height: 640px; /* Chiá»u cao cá»‘ Ä‘á»‹nh cá»§a canvas + padding */
    }

    ul.rooms { 
      list-style: none; 
      padding: 0; 
      margin: 16px 0; 
      max-height: 300px; 
      overflow-y: auto;
      border: 1px solid var(--border-color);
      border-radius: 6px;
    }
    
    ul.rooms li {
      background: #333;
      padding: 12px;
      margin: 0;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background 0.2s ease;
      text-align: left;
    }

    ul.rooms li:last-child {
      border-bottom: none;
    }

    ul.rooms li:hover { 
      background: #444; 
    }
    
    ul.rooms li.in-progress { 
      background: #500; 
      color: #aaa; 
      cursor: not-allowed; 
    }
    
    ul.rooms li.countdown { 
      background: #552200; 
      color: #FF9800; 
      cursor: not-allowed;
    }

    #playersList {
      flex-grow: 1; /* Sá»¬A: Cho nÃ³ láº¥p Ä‘áº§y khÃ´ng gian cÃ²n láº¡i */
      height: 150px; 
      overflow-y: auto;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 12px;
      margin: 16px 0 0 0; 
      background: #333;
    }

    #playersList > div {
      background: #3a3a3e;
      padding: 10px 12px;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
      border-left: 4px solid var(--accent);
    }
    
    #playersList > div strong { 
      font-size: 15px; 
      display: block;
      margin-bottom: 4px;
    }

    #playersList > div:last-child {
      margin-bottom: 0;
    }
    
    /* --- CSS CHO KHUNG CHAT Má»šI --- */
    #chat-container {
      display: none; /* áº¨n ban Ä‘áº§u, hiá»‡n sau khi login */
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 40px rgba(0,0,0,0.7);
      border-radius: 12px;
      width: 400px; /* Äá»™ rá»™ng cá»‘ Ä‘á»‹nh */
      height: 640px; /* Báº±ng chiá»u cao sidebar game */
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    #chat-container h3 {
      margin-bottom: 16px;
    }
    
    .chat-tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
    }
    .chat-tab {
      padding: 8px 16px;
      cursor: pointer;
      color: var(--text-dim);
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 600;
      font-family: 'Nunito', sans-serif;
    }
    .chat-tab.active {
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }
    #tabRoom {
      display: none; /* áº¨n tab phÃ²ng ban Ä‘áº§u */
    }
    
    .chat-display-area {
      flex-grow: 1;
      position: relative;
      margin: 16px 0;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: var(--bg-input);
    }
    
    .chat-display {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      overflow-y: auto;
      padding: 8px;
      font-size: 14px;
      word-wrap: break-word;
    }
    
    /* áº¨n/hiá»‡n mÃ n hÃ¬nh chat theo tab */
    #chatDisplayGlobal { display: block; }
    #chatDisplayRoom { display: none; }
    
    .chat-display > div {
      margin-bottom: 4px;
    }
    .chat-display .chat-global strong { color: #61dafb; }
    .chat-display .chat-room strong { color: #8BC34A; }
    .chat-display .chat-system { color: #aaa; font-style: italic; }
    
    #chatControls {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    #chatControls input {
      margin: 0;
      font-size: 14px;
    }
    #btnSendChat {
      margin: 0;
      font-size: 14px;
      padding: 10px;
    }
    /* --- Káº¾T THÃšC CSS CHAT --- */

    .hp-bar-container {
      margin-top: 6px;
      width: 100%;
      background: #333;
      padding: 2px;
      border-radius: 4px;
    }
    
    .hp-bar {
      height: 8px;
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    #roomControls {
      margin-top: auto; /* Äáº©y cá»¥m nÃºt xuá»‘ng dÆ°á»›i cÃ¹ng */
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-top: 16px; /* ThÃªm khoáº£ng cÃ¡ch vá»›i pháº§n chat */
      border-top: 1px solid var(--border-color);
    }

    /* --- MODAL Máº¬T KHáº¨U --- */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: var(--bg-panel);
      padding: 28px 32px;
      border-radius: 12px;
      box-shadow: 0 15px 50px rgba(0,0,0,0.9);
      border: 1px solid var(--border-color);
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    
    .modal-content h4 {
      margin: 0 0 20px 0;
      color: var(--accent);
      font-size: 20px;
    }
    
    .modal-content input {
      width: 100%;
      margin: 0 0 20px 0;
    }

    .welcome-text {
      color: var(--text-dim);
      margin-bottom: 20px;
      font-size: 16px;
    }

    .player-name {
      color: var(--accent);
      font-weight: bold;
      font-size: 18px;
    }

    .section-title {
      color: var(--text-light);
      margin: 20px 0 12px 0;
      font-size: 16px;
      font-weight: 600;
      text-align: left;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #2d2d30;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #666;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      body {
        padding: 10px;
        align-items: flex-start;
      }
      
      /* Sá»­a: CÃ¡c panel chÃ­nh sáº½ khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng */
      #game-container, #lobbyPanel, #chat-container {
        width: 100%;
        max-width: 500px; /* Äáº·t 1 Ä‘á»™ rá»™ng tá»‘i Ä‘a */
        margin: 0 auto; /* Tá»± Ä‘á»™ng cÄƒn giá»¯a */
        height: auto;
      }

      #game-container {
        flex-direction: column;
        padding: 15px;
      }

      #sidebar {
        width: 100%;
        height: auto;
        max-height: 400px;
      }

      #c {
        width: 100%;
        height: auto;
        max-width: 500px;
      }

      .panel {
        padding: 20px;
      }

      .button-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <div id="startPanel" class="panel">
    <h2>âš”ï¸ Gamin Arena</h2>
    <p class="welcome-text">ChÃ o má»«ng Ä‘áº¿n vá»›i Ä‘áº¥u trÆ°á»ng!</p>
    <input id="playerNameInput" placeholder="Nháº­p tÃªn cá»§a báº¡n..." maxlength="20" />
    <button id="btnEnter">VÃ o Game</button>
  </div>

  <div id="lobbyPanel" class="panel" style="display:none;">
    <h2>ğŸ® Trang Chá»§</h2>
    <p class="welcome-text">Xin chÃ o, <span id="displayName" class="player-name"></span></p>
    
    <div class="button-group">
      <button id="btnCreateRoom">â• Táº¡o PhÃ²ng</button>
      <button id="btnJoinRoom">ğŸšª VÃ o PhÃ²ng</button>
    </div>

    <div id="createForm" style="display:none; margin-top:20px; border-top:1px solid var(--border-color); padding-top:20px;">
      <h4>Táº¡o PhÃ²ng Má»›i</h4>
      <input id="roomNameInput" placeholder="TÃªn phÃ²ng..." />
      <input id="roomPassInput" type="password" placeholder="Máº­t kháº©u (tÃ¹y chá»n)" />
      <div class="button-group">
        <button id="btnCreateConfirm">âœ… Táº¡o</button>
        <button id="btnCreateCancel" class="back">âŒ Há»§y</button>
      </div>
    </div>

    <div id="roomListContainer" style="display:none; margin-top:20px; border-top:1px solid var(--border-color); padding-top:20px;">
      <h4>Danh SÃ¡ch PhÃ²ng</h4>
      <p class="section-title">Chá»n má»™t phÃ²ng Ä‘á»ƒ tham gia:</p>
      <ul id="roomList" class="rooms">
        <li>Äang táº£i danh sÃ¡ch phÃ²ng...</li>
      </ul>
      <button id="btnRoomBack" class="back">â†©ï¸ Quay Láº¡i</button>
    </div>
  </div>

  <div id="game-container" style="display:none;">
    <div id="canvas-area">
      <canvas id="c" width="800" height="600"></canvas>
      <div id="countdownDisplay">5</div>
      <div id="info">Äang káº¿t ná»‘i...</div>
      <div id="debug"></div>
    </div>
    
    <div id="sidebar">
      <h3>ğŸ‘¥ NgÆ°á»i ChÆ¡i</h3>
            
      <div id="playersList">
        <div>Äang káº¿t ná»‘i...</div>
      </div>
      
      <div id="roomControls">
        <button id="btnStartGame" class="start" style="display:none;">ğŸ¯ Báº¯t Äáº§u Tráº­n Äáº¥u</button>
        <button id="btnCancelGame" class="cancel" style="display:none;">â¹ï¸ Há»§y Äáº¿m NgÆ°á»£c</button>
        <button id="btnEndGame" class="back" style="display:none;">ğŸ Káº¿t ThÃºc Tráº­n Äáº¥u</button>
        <button id="respawnButton" style="display:none;">ğŸ’« Há»’I SINH</button>
        <button id="btnLeaveRoom" class="back">ğŸšª ThoÃ¡t PhÃ²ng</button>
      </div>
    </div>
  </div>
  
  <div id="chat-container" style="display: none;">
    <h3>ğŸ“¢ Chat</h3>
    <div class="chat-tabs">
      <button id="tabGlobal" class="chat-tab active">Global</button>
      <button id="tabRoom" class="chat-tab">PhÃ²ng</button>
    </div>
    <div class="chat-display-area">
      <div id="chatDisplayGlobal" class="chat-display">
        </div>
      <div id="chatDisplayRoom" class="chat-display">
        </div>
    </div>
    <div id="chatControls">
      <input id="chatInput" type="text" placeholder="Nháº­p chat..." style="font-size: 14px;">
      <button id="btnSendChat" style="font-size: 14px; padding: 10px;">Gá»­i</button>
    </div>
  </div>
  <div id="passwordModal" class="modal-overlay">
    <div class="modal-content">
      <h4 id="passModalTitle">ğŸ” Nháº­p Máº­t Kháº©u</h4>
      <input id="passInput" type="password" placeholder="Nháº­p máº­t kháº©u phÃ²ng..." />
      <input type="hidden" id="hiddenRoomIdInput" />
      <div class="button-group">
        <button id="btnPassConfirm">âœ… XÃ¡c Nháº­n</button>
        <button id="btnPassCancel" class="back">âŒ Há»§y</button>
      </div>
    </div>
  </div>

  <script type="module" src="./main.js"></script>
</body>
</html>